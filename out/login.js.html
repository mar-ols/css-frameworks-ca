<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: login.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: login.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { API_BASE, API_LOGIN } from "../constants.js";
import { loginRegSuccess } from "../../functions/userMessages/registerSuccess.js";
import * as storage from "../../functions/storage/localStorage.js";

/**
 * This function takes an object as parameter, stringifies the object and sends an API POST call to the database to log in a user. If response is successful it saves an access token and the user information in localStorage and redirects the user to the feed page. If the user has input the wrong email or password a message will be passed to the user.
 * @param {object} user Object containing values from loginForm
 * @example
 * ```
 * async function login(user) {
 *   const loginURL = API_BASE + API_LOGIN;
 *   try {
 *     const postData = {
 *       method: "POST",
 *       headers: {
 *         "Content-Type": "application/json",
 *       },
 *       body: JSON.stringify(user),
 *     };
 *     const response = await fetch(loginURL, postData);
 *     const json = await response.json();
 *     if (response.ok) {
 *       storage.saveStorage("token", json.accessToken);
 *       storage.saveStorage("profile", {
 *         userName: json.name,
 *         userEmail: json.email,
 *         userAvatar: json.avatar,
 *       });
 *       window.location.href = "feed/";
 *     } else {
 *       const status = json.statusCode;
 *       if (status === 401) {
 *         loginRegSuccess(`Wrong email or password!`);
 *       }
 *     }
 *   } catch (error) {
 *     console.error(error);
 *   }
 * }
 * ```
 */
export async function login(user) {
  const loginURL = API_BASE + API_LOGIN;
  try {
    const postData = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(user),
    };
    const response = await fetch(loginURL, postData);
    const json = await response.json();
    if (response.ok) {
      storage.saveStorage("token", json.accessToken);
      storage.saveStorage("profile", {
        userName: json.name,
        userEmail: json.email,
        userAvatar: json.avatar,
      });

      window.location.href = "feed/";
    } else {
      const status = json.statusCode;
      if (status === 401) {
        loginRegSuccess(`Wrong email or password!`);
      }
    }
  } catch (error) {
    console.error(error);
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#changeAvatar">changeAvatar</a></li><li><a href="global.html#createPost">createPost</a></li><li><a href="global.html#getPost">getPost</a></li><li><a href="global.html#getPosts">getPosts</a></li><li><a href="global.html#getProfile">getProfile</a></li><li><a href="global.html#getUserPosts">getUserPosts</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#removePost">removePost</a></li><li><a href="global.html#updatePost">updatePost</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Feb 23 2024 12:25:01 GMT+0100 (sentraleuropeisk normaltid)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
